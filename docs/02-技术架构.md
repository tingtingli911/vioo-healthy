# 技术架构

## 技术栈

### 前端技术栈
- **框架**：Vue 3.4.0（Composition API）
- **构建工具**：Vite 5.0.0
- **路由**：Vue Router 4.6.4
- **UI 组件库**：Element Plus 2.13.1
- **图标**：@element-plus/icons-vue 2.3.2
- **HTTP 客户端**：原生 Fetch API

### 后端技术栈
- **框架**：Django 5.0.0
- **API 框架**：Django REST Framework 3.14.0
- **数据库驱动**：PyMySQL 1.1.0
- **加密库**：cryptography 42.0.0
- **环境变量管理**：python-dotenv 1.0.0

### 数据库
- **数据库**：MySQL 8.0

### 部署与运维
- **容器化**：Docker + Docker Compose
- **Web 服务器**：Nginx（生产环境）
- **进程管理**：Django WSGI/ASGI

## 架构设计

### 整体架构
```
┌─────────────┐
│   用户浏览器  │
└──────┬──────┘
       │ HTTP/HTTPS
┌──────▼──────┐
│   Nginx     │ (反向代理)
└──────┬──────┘
       │
   ┌───┴───┐
   │       │
┌──▼──┐ ┌─▼────┐
│前端 │ │ 后端 │
│Vue  │ │Django│
└─────┘ └──┬───┘
           │
      ┌────▼────┐
      │  MySQL  │
      └─────────┘
```

### 前后端分离架构
- **前端**：独立部署，通过 HTTP API 与后端通信
- **后端**：提供 RESTful API，不直接渲染页面
- **认证**：基于 Token 的认证机制

## 目录结构

### 项目根目录
```
vioo-healthy/
├── frontend/              # Vue 前端项目
│   ├── src/
│   │   ├── api/          # API 接口封装
│   │   ├── router/       # 路由配置
│   │   ├── views/        # 页面组件
│   │   ├── styles/       # 样式文件
│   │   ├── App.vue       # 根组件
│   │   └── main.js       # 入口文件
│   ├── Dockerfile        # 前端 Docker 镜像
│   ├── index.html        # HTML 模板
│   ├── nginx.conf        # Nginx 配置
│   ├── package.json      # 依赖配置
│   └── vite.config.js    # Vite 配置
├── backend/              # Django 后端项目
│   ├── healthy/          # Django 项目配置
│   │   ├── settings.py  # 项目设置
│   │   ├── urls.py      # 根 URL 配置
│   │   ├── wsgi.py      # WSGI 配置
│   │   └── asgi.py      # ASGI 配置
│   ├── users/           # 用户应用
│   │   ├── models.py    # 数据模型
│   │   ├── views.py     # 视图函数
│   │   ├── serializers.py # 序列化器
│   │   ├── urls.py      # URL 路由
│   │   ├── authentication.py # 认证类
│   │   └── permissions.py # 权限类
│   ├── manage.py        # Django 管理脚本
│   ├── requirements.txt # Python 依赖
│   ├── Dockerfile       # 后端 Docker 镜像
│   └── start.sh         # 启动脚本
├── nginx/               # Nginx 配置
├── scripts/             # 自动化脚本
│   ├── dev.sh          # 开发环境启动
│   ├── stop.sh         # 停止服务
│   ├── build.sh        # 构建镜像
│   └── deploy.sh       # 部署脚本
├── docs/                # 项目文档
├── docker-compose.yml   # 开发环境配置
├── docker-compose.deploy.yml # 生产环境配置
└── README.md           # 项目说明
```

### 前端目录结构
```
frontend/src/
├── api/                 # API 接口
│   └── auth.js         # 认证相关 API
├── router/             # 路由
│   └── index.js        # 路由配置
├── views/              # 页面组件
│   ├── Home.vue        # 首页
│   ├── Login.vue       # 登录页
│   └── Register.vue    # 注册页
├── styles/             # 样式
│   └── theme.css       # 主题样式
├── App.vue             # 根组件
└── main.js             # 入口文件
```

### 后端目录结构
```
backend/
├── healthy/            # Django 项目
│   ├── settings.py     # 配置
│   ├── urls.py         # URL 路由
│   └── ...
├── users/              # 用户应用
│   ├── models.py       # 数据模型
│   ├── views.py        # 视图
│   ├── serializers.py  # 序列化器
│   ├── urls.py         # URL 路由
│   ├── authentication.py # 认证
│   ├── permissions.py  # 权限
│   └── migrations/     # 数据库迁移
└── manage.py           # 管理脚本
```

## 数据流

### 用户认证流程
```
1. 用户提交登录信息
   ↓
2. 前端发送 POST /api/users/login/
   ↓
3. 后端验证用户名密码
   ↓
4. 生成 Token（7天有效期）
   ↓
5. 返回 Token 和用户信息
   ↓
6. 前端保存 Token 到 localStorage
   ↓
7. 后续请求携带 Token（Authorization: Bearer <token>）
   ↓
8. 后端验证 Token 有效性
```

### API 请求流程
```
前端组件
  ↓
API 封装层 (api/auth.js)
  ↓
HTTP 请求 (Fetch API)
  ↓
Nginx 反向代理
  ↓
Django 后端
  ↓
Token 认证中间件
  ↓
视图函数
  ↓
序列化器验证
  ↓
数据库操作
  ↓
返回 JSON 响应
```

## 环境配置

### 开发环境
- **前端端口**：3008
- **后端端口**：3009
- **数据库端口**：3007
- **数据库名称**：healthy

### 生产环境
- **前端端口**：80
- **后端端口**：8000
- **Nginx 代理端口**：8080
- **数据库端口**：3306

## 安全机制

1. **Token 认证**：所有需要认证的接口都需要 Token
2. **Token 过期**：Token 有效期为 7 天，过期后需要重新登录
3. **权限控制**：基于角色的权限控制（普通用户/超级管理员）
4. **CORS 配置**：生产环境需要配置 CORS
5. **环境变量**：敏感信息通过环境变量管理

---

**最后更新**：2025-01-27
