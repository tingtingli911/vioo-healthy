# 开发规范

## 代码规范

### Python 代码规范（后端）

#### 命名规范
- **类名**：使用大驼峰命名（PascalCase），如 `User`, `TokenAuthentication`
- **函数名**：使用小写下划线命名（snake_case），如 `create_token`, `handle_login`
- **变量名**：使用小写下划线命名（snake_case），如 `user_id`, `token_string`
- **常量名**：使用大写下划线命名（UPPER_SNAKE_CASE），如 `MAX_TOKEN_LENGTH`

#### 代码风格
- 遵循 PEP 8 规范
- 使用 4 个空格缩进
- 每行代码不超过 100 个字符
- 导入语句按标准库、第三方库、本地模块分组

#### 示例代码
```python
# 好的示例
class User(models.Model):
    """用户模型"""
    username = models.CharField(max_length=150, unique=True)
    
    def is_super(self):
        """判断是否是超级用户"""
        return self.is_superuser

# 不好的示例
class user(models.Model):  # 类名应该大写
    Username = models.CharField(max_length=150, unique=True)  # 字段名应该小写
```

### JavaScript/Vue 代码规范（前端）

#### 命名规范
- **组件名**：使用大驼峰命名（PascalCase），如 `Login.vue`, `UserInfo.vue`
- **函数名**：使用小驼峰命名（camelCase），如 `handleLogin`, `getUserInfo`
- **变量名**：使用小驼峰命名（camelCase），如 `userInfo`, `isLoading`
- **常量名**：使用大写下划线命名（UPPER_SNAKE_CASE），如 `API_BASE_URL`

#### 代码风格
- 使用 2 个空格缩进
- 使用单引号（'）而不是双引号（"）
- 在对象和数组的最后一个元素后添加逗号
- 使用 ES6+ 语法

#### 示例代码
```javascript
// 好的示例
const API_BASE_URL = '/api'

export async function login(username, password) {
  const response = await fetch(`${API_BASE_URL}/users/login/`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ username, password }),
  })
  return await response.json()
}

// 不好的示例
var api_base_url = "/api"  // 应该使用 const 和 UPPER_SNAKE_CASE
function Login(username, password) {  // 函数名应该小写开头
  // ...
}
```

### Vue 组件规范

#### 组件结构
```vue
<template>
  <!-- 模板内容 -->
</template>

<script>
// 脚本内容
</script>

<style scoped>
/* 样式内容 */
</style>
```

#### 组件命名
- 组件文件名使用大驼峰命名：`Login.vue`, `UserInfo.vue`
- 组件内部 name 属性与文件名一致

#### Composition API 使用
- 优先使用 Composition API（`setup()`）
- 使用 `ref` 和 `reactive` 管理状态
- 使用 `onMounted` 等生命周期钩子

## 文件组织规范

### 后端文件组织
```
backend/
├── healthy/          # Django 项目配置
│   ├── settings.py   # 项目设置
│   └── urls.py       # URL 路由
├── users/            # 应用目录
│   ├── models.py     # 数据模型
│   ├── views.py      # 视图函数
│   ├── serializers.py # 序列化器
│   ├── urls.py       # URL 路由
│   └── migrations/   # 数据库迁移
└── manage.py         # 管理脚本
```

### 前端文件组织
```
frontend/src/
├── api/              # API 接口封装
│   └── auth.js       # 认证相关 API
├── router/           # 路由配置
│   └── index.js
├── views/            # 页面组件
│   ├── Home.vue
│   ├── Login.vue
│   └── Register.vue
├── styles/           # 样式文件
│   └── theme.css
├── App.vue           # 根组件
└── main.js           # 入口文件
```

## API 设计规范

### RESTful API 设计
- 使用标准 HTTP 方法：GET（查询）、POST（创建）、PUT（更新）、DELETE（删除）
- URL 使用名词，不使用动词
- 使用复数形式：`/api/users/` 而不是 `/api/user/`
- 使用连字符分隔：`/api/users/admin-dashboard/`

### 响应格式规范
所有 API 响应必须遵循统一格式：
```json
{
  "code": 0,        // 0 表示成功，1 表示失败
  "message": "操作成功",
  "data": {
    // 具体数据
  }
}
```

### 错误处理规范
- 使用标准 HTTP 状态码
- 错误信息放在 `message` 字段
- 详细错误信息放在 `errors` 字段（可选）

## 数据库规范

### 模型设计规范
- 每个模型都要有 `__str__` 方法
- 使用 `verbose_name` 和 `verbose_name_plural` 设置中文名称
- 使用 `db_table` 明确指定表名
- 时间字段使用 `auto_now_add` 和 `auto_now`

### 迁移文件规范
- 每次修改模型后必须创建迁移文件
- 迁移文件名要有描述性：`0002_add_user_is_superuser.py`
- 不要手动修改已应用的迁移文件

## 文档更新规范

### 何时更新文档
1. **新增功能**：必须更新 `03-功能模块.md` 和 `CHANGELOG.md`
2. **API 变更**：必须更新 `04-API文档.md`
3. **数据库变更**：必须更新 `05-数据库设计.md`
4. **架构调整**：必须更新 `02-技术架构.md`
5. **规范变更**：必须更新 `06-开发规范.md`

### 文档更新流程
1. 开发功能前，先查看相关文档
2. 开发过程中，同步更新文档
3. 代码提交前，确保文档已更新
4. 在 `CHANGELOG.md` 中记录变更

### 文档格式规范
- 使用 Markdown 格式
- 标题使用 `#` 标记
- 代码块使用三个反引号
- 表格使用标准 Markdown 表格格式
- 重要信息使用 **粗体** 或 `代码` 标记

## Git 提交规范

### 提交信息格式
```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type 类型
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整（不影响功能）
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

### 提交示例
```
feat(user): 添加用户注册功能

- 实现用户注册接口
- 添加用户名唯一性验证
- 第一个用户自动成为超级管理员

Closes #123
```

## 测试规范

### 测试文件位置
- 后端测试：`backend/users/tests.py`
- 前端测试：待补充

### 测试命名规范
- 测试函数名以 `test_` 开头
- 测试类名以 `Test` 开头

### 测试示例
```python
from django.test import TestCase
from users.models import User

class TestUserModel(TestCase):
    def test_create_user(self):
        """测试创建用户"""
        user = User.objects.create(
            username='testuser',
            password='123456'
        )
        self.assertEqual(user.username, 'testuser')
```

## 代码审查规范

### 审查清单
- [ ] 代码符合命名规范
- [ ] 代码有适当的注释
- [ ] 没有硬编码的敏感信息
- [ ] API 响应格式统一
- [ ] 错误处理完善
- [ ] 文档已更新
- [ ] 测试通过

## 安全规范

### 敏感信息处理
- 所有敏感信息（密码、密钥等）必须通过环境变量配置
- 不要将敏感信息提交到 Git
- `.env` 文件必须添加到 `.gitignore`

### 认证和授权
- 所有需要认证的接口都要使用 Token 认证
- 权限检查要明确，不要依赖前端验证
- Token 要有过期时间

---

**最后更新**：2025-01-27
