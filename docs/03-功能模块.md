# 功能模块

## 功能清单

### ✅ 已实现功能

#### 1. 用户认证模块
- **用户注册**
  - 用户名和密码注册
  - 用户名唯一性验证
  - 第一个注册用户自动成为超级管理员
  - 注册成功后自动登录（返回 Token）

- **用户登录**
  - 用户名密码登录
  - Token 生成（7天有效期）
  - 登录状态保持

- **用户信息**
  - 获取当前登录用户信息
  - 显示用户角色（普通用户/超级管理员）
  - 显示注册时间

- **退出登录**
  - 清除本地 Token
  - 跳转到登录页

#### 2. 权限管理模块
- **超级管理员权限**
  - 首个注册用户自动成为超级管理员
  - 超级管理员可以访问管理后台接口
  - 权限验证中间件

#### 3. 前端页面
- **登录页面** (`/login`)
  - 用户名密码输入
  - 表单验证
  - 登录按钮和加载状态
  - 跳转到注册页链接

- **注册页面** (`/register`)
  - 用户名密码输入
  - 确认密码输入
  - 表单验证（用户名长度、密码长度、密码一致性）
  - 注册按钮和加载状态
  - 跳转到登录页链接

- **首页** (`/`)
  - 用户信息展示
  - 用户角色标识
  - 功能模块导航卡片
  - 快速访问各个功能模块

- **布局组件** (`Layout.vue`)
  - 侧边栏导航菜单（可折叠）
  - 顶部栏（用户信息和退出按钮）
  - 响应式布局设计

#### 4. 核心功能模块导航
- **体重管理** (`/weight`)
  - 导航入口已创建
  - 功能开发中

- **血糖管理** (`/blood-sugar`)
  - 导航入口已创建
  - 显示"敬请期待"提示

- **体检报告** (`/health-report`)
  - 导航入口已创建
  - 显示"敬请期待"提示

- **AI 智能推荐** (`/ai-recommend`)
  - 导航入口已创建
  - 显示"敬请期待"提示

### 🔄 开发中功能

#### 1. 体重管理模块（开发中）
- 体重数据录入
- 体重数据查询
- 体重数据编辑
- 体重数据删除
- 体重趋势图表
- 体重统计分析

#### 2. 血糖管理模块（规划中）
- 血糖数据录入
- 血糖数据查询
- 血糖数据编辑
- 血糖数据删除
- 血糖趋势图表
- 血糖统计分析

#### 3. 体检报告模块（规划中）
- 体检报告上传
- 体检报告查看
- 体检报告管理
- 体检数据提取
- 历史报告对比

#### 4. AI 智能推荐模块（规划中）
- 基于健康数据的智能分析
- 个性化健康建议
- 健康趋势预测
- 异常指标提醒

## 功能模块详细说明

### 用户认证模块

#### 注册功能
**前端页面**：`frontend/src/views/Register.vue`
**后端接口**：`POST /api/users/register/`

**功能流程**：
1. 用户填写用户名和密码
2. 前端验证表单（用户名长度3-20字符，密码至少6位）
3. 发送注册请求到后端
4. 后端验证用户名唯一性
5. 创建用户（第一个用户设为超级管理员）
6. 生成 Token 并返回
7. 前端保存 Token 并跳转到首页

**特殊逻辑**：
- 第一个注册的用户自动成为超级管理员（`is_superuser=True`）
- 后续注册的用户都是普通用户

#### 登录功能
**前端页面**：`frontend/src/views/Login.vue`
**后端接口**：`POST /api/users/login/`

**功能流程**：
1. 用户输入用户名和密码
2. 前端验证表单
3. 发送登录请求到后端
4. 后端验证用户名和密码（明文比较）
5. 验证通过后生成或更新 Token
6. 返回 Token 和用户信息
7. 前端保存 Token 并跳转到首页

**Token 机制**：
- Token 长度：40 个字符
- Token 有效期：7 天
- Token 存储：前端 localStorage
- Token 格式：`Bearer <token>`

#### 用户信息获取
**后端接口**：`GET /api/users/info/`

**功能流程**：
1. 前端从 localStorage 获取 Token
2. 请求头携带 `Authorization: Bearer <token>`
3. 后端验证 Token 有效性
4. 返回用户信息（ID、用户名、角色、注册时间）

### 权限管理模块

#### 超级管理员权限
**权限类**：`backend/users/permissions.py::IsSuperUser`
**认证类**：`backend/users/permissions.py::TokenAuthentication`

**权限检查流程**：
1. Token 认证中间件验证用户身份
2. 权限类检查 `user.is_superuser` 属性
3. 只有超级管理员才能访问受保护接口

**受保护接口示例**：
- `GET /api/users/admin/dashboard/` - 管理后台仪表盘

### 前端页面模块

#### 路由配置
**文件**：`frontend/src/router/index.js`

**路由列表**：
- `/` - 首页（需要登录，使用 Layout 布局）
- `/login` - 登录页（未登录可访问）
- `/register` - 注册页（未登录可访问）
- `/weight` - 体重管理（需要登录，使用 Layout 布局）
- `/blood-sugar` - 血糖管理（需要登录，使用 Layout 布局）
- `/health-report` - 体检报告（需要登录，使用 Layout 布局）
- `/ai-recommend` - AI 智能推荐（需要登录，使用 Layout 布局）

**路由守卫**：
- 所有功能页面需要 Token 认证
- 未登录用户访问功能页面会自动跳转到登录页
- 已登录用户访问登录/注册页会自动跳转到首页

#### 页面组件

**登录页** (`Login.vue`)
- 品牌标识：VIOO
- 用户名输入框（带图标）
- 密码输入框（带图标，可显示/隐藏）
- 登录按钮（带加载状态）
- 注册链接

**注册页** (`Register.vue`)
- 品牌标识：VIOO
- 用户名输入框（带图标）
- 密码输入框（带图标，可显示/隐藏）
- 确认密码输入框（带图标，可显示/隐藏）
- 注册按钮（带加载状态）
- 登录链接

**布局组件** (`Layout.vue`)
- 侧边栏导航菜单（可折叠）
  - 首页
  - 体重管理
  - 血糖管理
  - 体检报告
  - AI 智能推荐
- 顶部栏
  - 侧边栏折叠/展开按钮
  - 用户信息显示
  - 超级管理员标识
  - 退出登录按钮
- 主内容区域（router-view）

**首页** (`Home.vue`)
- 用户信息卡片
- 功能模块导航卡片（4个模块）
- 超级管理员提示

**核心模块页面**：
- **体重管理** (`Weight.vue`) - 功能开发中
- **血糖管理** (`BloodSugar.vue`) - 显示"敬请期待"
- **体检报告** (`HealthReport.vue`) - 显示"敬请期待"
- **AI 智能推荐** (`AIRecommend.vue`) - 显示"敬请期待"

## API 响应格式

所有 API 响应遵循统一格式：

**成功响应**：
```json
{
  "code": 0,
  "message": "操作成功",
  "data": {
    // 具体数据
  }
}
```

**失败响应**：
```json
{
  "code": 1,
  "message": "错误信息",
  "errors": {
    // 详细错误信息（可选）
  }
}
```

## 数据验证规则

### 用户名验证
- 必填
- 长度：3-20 个字符
- 唯一性：不能重复

### 密码验证
- 必填
- 最小长度：6 个字符
- 注册时需要确认密码一致

## 错误处理

### 前端错误处理
- 网络错误：显示"网络错误，请稍后重试"
- 认证错误：清除 Token，跳转到登录页
- 表单验证错误：显示具体错误信息

### 后端错误处理
- 400：请求参数错误
- 401：认证失败（Token 无效或过期）
- 403：权限不足
- 500：服务器内部错误

---

**最后更新**：2025-01-27
